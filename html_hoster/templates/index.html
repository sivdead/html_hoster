<!DOCTYPE html>
<html lang="zh-CN" class="dark:bg-gray-900">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HTML Hoster - 静态网站托管平台</title>
    <link href="https://cdn.jsdelivr.net/npm/remixicon@4.0.0/fonts/remixicon.css" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: {
                            50: '#eef2ff',
                            100: '#e0e7ff',
                            200: '#c7d2fe',
                            300: '#a5b4fc',
                            400: '#818cf8',
                            500: '#6366f1',
                            600: '#4f46e5',
                            700: '#4338ca',
                            800: '#3730a3',
                            900: '#312e81',
                            950: '#1e1b4b',
                        },
                    }
                }
            }
        }
    </script>
    <style type="text/tailwindcss">
        @layer utilities {
            .animation-delay-200 {
                animation-delay: 0.2s;
            }
            .animation-delay-400 {
                animation-delay: 0.4s;
            }
        }
        
        .gradient-background {
            @apply absolute top-0 left-0 right-0 h-[500px] bg-gradient-to-br from-indigo-500 to-purple-600 -z-10;
            clip-path: polygon(0 0, 100% 0, 100% 65%, 0 100%);
        }
        
        .dark .gradient-background {
            @apply opacity-70 from-indigo-800 to-purple-900;
        }

        @keyframes fadeInDown {
            from {
                opacity: 0;
                transform: translateY(-30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes slideInLeft {
            from {
                opacity: 0;
                transform: translateX(-30px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        @keyframes slideOutLeft {
            from {
                opacity: 1;
                transform: translateX(0);
            }
            to {
                opacity: 0;
                transform: translateX(-30px);
            }
        }
        
        .animate-fadeInDown {
            animation: fadeInDown 0.8s ease-out;
        }
        
        .animate-fadeInUp {
            animation: fadeInUp 0.8s ease-out;
        }
        
        .animate-slideInLeft {
            animation: slideInLeft 0.5s ease-out;
        }
        
        .animate-slideOutLeft {
            animation: slideOutLeft 0.5s ease-out;
        }
        
        .drag-over {
            @apply bg-indigo-50 dark:bg-indigo-900/30 border-indigo-600 scale-[1.02];
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-800 dark:bg-gray-900 dark:text-gray-200 min-h-screen relative overflow-x-hidden transition-colors duration-300">
    <div class="gradient-background"></div>
    
    <!-- Theme switcher -->
    <button id="themeSwitcher" class="fixed top-5 right-5 bg-white dark:bg-gray-800 rounded-full w-11 h-11 flex items-center justify-center shadow-lg hover:scale-110 transition-transform z-50">
        <i class="ri-moon-line dark:ri-sun-line text-xl text-indigo-600 dark:text-indigo-400"></i>
    </button>

    <!-- Loading overlay -->
    <div id="loading" class="hidden fixed inset-0 bg-black/50 z-[9999] items-center justify-center">
        <div class="w-12 h-12 border-4 border-white border-t-transparent rounded-full animate-spin"></div>
    </div>

    <div class="max-w-7xl mx-auto px-4 py-8 relative z-10">
        <!-- Header -->
        <header class="text-center mb-12 animate-fadeInDown">
            <h1 class="text-4xl md:text-5xl font-extrabold mb-4 flex items-center justify-center gap-2 text-white">
                <i class="ri-cloud-line"></i> HTML Hoster
            </h1>
            <p class="text-xl text-white/90 font-light">快速部署你的静态网站到云端</p>
        </header>

        <!-- Main content -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-12">
            <!-- Upload card -->
            <div class="bg-white dark:bg-gray-800 rounded-2xl p-8 shadow-lg transition-all hover:translate-y-[-5px] hover:shadow-xl animate-fadeInUp">
                <div class="flex items-center gap-4 mb-6">
                    <i class="ri-upload-cloud-2-line text-3xl text-indigo-600 dark:text-indigo-400"></i>
                    <h2 class="text-2xl font-bold">上传网站</h2>
                </div>
                <form id="uploadForm" action="/upload" method="post" enctype="multipart/form-data">
                    <div id="uploadArea" class="border-2 border-dashed border-indigo-400 dark:border-indigo-600 rounded-lg p-12 text-center bg-indigo-50/50 dark:bg-indigo-900/20 transition-all cursor-pointer relative overflow-hidden">
                        <i class="ri-folder-zip-line text-5xl text-indigo-600 dark:text-indigo-400 mb-4"></i>
                        <p class="text-gray-700 dark:text-gray-300 mb-2">拖拽 ZIP 文件到这里，或点击选择文件</p>
                        <p class="text-sm text-gray-500 dark:text-gray-400">支持包含 index.html 的 ZIP 压缩包</p>
                        <input type="file" name="file" id="fileInput" accept=".zip" required class="absolute inset-0 opacity-0 cursor-pointer">
                    </div>
                    <button type="submit" class="w-full mt-4 bg-indigo-600 hover:bg-indigo-700 text-white py-3 px-6 rounded-lg font-semibold flex items-center justify-center gap-2 transition-colors">
                        <i class="ri-upload-line"></i> 上传并发布
                    </button>
                </form>
            </div>

            <!-- Paste code card -->
            <div class="bg-white dark:bg-gray-800 rounded-2xl p-8 shadow-lg transition-all hover:translate-y-[-5px] hover:shadow-xl animate-fadeInUp animation-delay-200">
                <div class="flex items-center gap-4 mb-6">
                    <i class="ri-code-s-slash-line text-3xl text-indigo-600 dark:text-indigo-400"></i>
                    <h2 class="text-2xl font-bold">粘贴代码</h2>
                </div>
                <form id="pasteForm" action="/paste_site" method="post">
                    <div class="mb-6">
                        <label class="block text-gray-700 dark:text-gray-300 font-semibold mb-2" for="siteName">网站名称</label>
                        <input type="text" id="siteName" name="site_name" class="w-full px-4 py-3 rounded-lg border-2 border-gray-200 dark:border-gray-700 focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200 dark:focus:ring-indigo-900 bg-white dark:bg-gray-800 outline-none transition-colors" placeholder="我的网站" required>
                    </div>
                    <div class="mb-6">
                        <label class="block text-gray-700 dark:text-gray-300 font-semibold mb-2" for="htmlCode">HTML 源代码</label>
                        <textarea id="htmlCode" name="html_code" class="w-full px-4 py-3 rounded-lg border-2 border-gray-200 dark:border-gray-700 focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200 dark:focus:ring-indigo-900 bg-white dark:bg-gray-800 outline-none transition-colors font-mono text-sm min-h-[150px] resize-y" placeholder="<!DOCTYPE html>..." required></textarea>
                    </div>
                    <button type="submit" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white py-3 px-6 rounded-lg font-semibold flex items-center justify-center gap-2 transition-colors">
                        <i class="ri-send-plane-line"></i> 发布网站
                    </button>
                </form>
            </div>
        </div>

        <!-- Sites container -->
        <div class="bg-white dark:bg-gray-800 rounded-2xl p-8 shadow-lg animate-fadeInUp animation-delay-400">
            <div class="flex items-center justify-between mb-8 pb-4 border-b border-gray-200 dark:border-gray-700">
                <h2 class="text-2xl font-bold flex items-center gap-3">
                    <i class="ri-global-line text-indigo-600 dark:text-indigo-400"></i> 
                    已发布的网站
                </h2>
                <span class="bg-indigo-600 text-white text-sm font-semibold py-1 px-3 rounded-full">{{ sites|length }} 个网站</span>
            </div>
            <div id="sitesList" class="space-y-4">
                {% if sites %}
                    {% for site in sites %}
                    <div class="site-item group bg-gray-100 dark:bg-gray-700/50 rounded-lg p-6 flex flex-col md:flex-row md:items-center justify-between gap-4 transition-all hover:bg-indigo-50 dark:hover:bg-indigo-900/20 hover:translate-x-1 animate-slideInLeft" data-site-id="{{ site.id }}" data-site-name="{{ site.name }}">
                        <div class="site-info">
                            <div class="flex items-center flex-wrap gap-2">
                                <h3 class="font-semibold flex items-center gap-2 text-lg">
                                    <i class="ri-earth-line text-indigo-600 dark:text-indigo-400"></i>
                                    <span class="site-title">{{ site.name }}</span>
                                </h3>
                                <span class="inline-flex items-center gap-1 text-xs font-semibold bg-indigo-100 dark:bg-indigo-900/50 text-indigo-700 dark:text-indigo-300 py-1 px-3 rounded-full">
                                    <i class="ri-check-line"></i> 已发布
                                </span>
                            </div>
                            <div class="text-sm text-gray-600 dark:text-gray-400 mt-1">
                                站点 ID: {{ site.id[:8] }}... • 创建于 {{ site.created_at.strftime('%Y-%m-%d %H:%M') if site.created_at else '未知时间' }}
                            </div>
                        </div>
                        <div class="site-actions flex flex-wrap gap-2">
                            <button class="preview-btn inline-flex items-center gap-1 bg-gray-200 hover:bg-gray-300 dark:bg-gray-600 dark:hover:bg-gray-500 text-gray-800 dark:text-gray-200 text-sm font-semibold py-2 px-3 rounded-lg transition-colors" data-site-url="/site/{{ site.id }}/index.html" data-site-name="{{ site.name }}">
                                <i class="ri-eye-line"></i> 快速预览
                            </button>
                            <a href="/site/{{ site.id }}/index.html" target="_blank" class="inline-flex items-center gap-1 bg-gray-200 hover:bg-gray-300 dark:bg-gray-600 dark:hover:bg-gray-500 text-gray-800 dark:text-gray-200 text-sm font-semibold py-2 px-3 rounded-lg transition-colors">
                                <i class="ri-external-link-line"></i> 访问站点
                            </a>
                            <a href="{{ site.oss_url }}" target="_blank" class="inline-flex items-center gap-1 bg-gray-200 hover:bg-gray-300 dark:bg-gray-600 dark:hover:bg-gray-500 text-gray-800 dark:text-gray-200 text-sm font-semibold py-2 px-3 rounded-lg transition-colors">
                                <i class="ri-link"></i> OSS 地址
                            </a>
                            <button class="rename-btn inline-flex items-center gap-1 bg-gray-200 hover:bg-gray-300 dark:bg-gray-600 dark:hover:bg-gray-500 text-gray-800 dark:text-gray-200 text-sm font-semibold py-2 px-3 rounded-lg transition-colors">
                                <i class="ri-edit-line"></i> 重命名
                            </button>
                            <button class="delete-btn inline-flex items-center gap-1 bg-red-500 hover:bg-red-600 text-white text-sm font-semibold py-2 px-3 rounded-lg transition-colors">
                                <i class="ri-delete-bin-line"></i> 删除
                            </button>
                        </div>
                    </div>
                    {% endfor %}
                {% else %}
                    <div class="text-center py-12 text-gray-500 dark:text-gray-400">
                        <i class="ri-inbox-line text-6xl mb-4 opacity-30"></i>
                        <p class="text-lg">还没有发布任何网站</p>
                        <p class="text-sm mt-2">上传你的第一个网站吧！</p>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Toast notifications -->
    <div id="toast" class="fixed bottom-8 right-8 transform translate-x-[400px] transition-transform duration-300 bg-gray-800 text-white py-4 px-6 rounded-lg shadow-2xl flex items-center gap-3 z-[9999]">
        <i class="ri-check-line"></i>
        <span id="toastMessage">操作成功</span>
    </div>

    <!-- Preview modal -->
    <div id="previewModal" class="fixed inset-0 bg-black/70 z-[9998] hidden overflow-y-auto">
        <div class="max-w-[90%] w-[1200px] mx-auto my-8 bg-white dark:bg-gray-800 rounded-2xl shadow-2xl overflow-hidden animate-fadeInUp">
            <div class="flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-700">
                <h3 class="text-xl font-semibold flex items-center gap-2">
                    <i class="ri-eye-line text-indigo-600 dark:text-indigo-400"></i>
                    <span id="previewSiteName">站点预览</span>
                </h3>
                <button id="closePreviewBtn" class="text-2xl text-gray-500 hover:text-red-500 transition-colors">&times;</button>
            </div>
            <div class="h-[80vh]">
                <iframe id="previewFrame" class="w-full h-full border-0"></iframe>
            </div>
        </div>
    </div>
    
    <!-- Rename modal -->
    <div id="renameModal" class="fixed inset-0 bg-black/70 z-[9998] hidden overflow-y-auto">
        <div class="max-w-md mx-auto my-20 bg-white dark:bg-gray-800 rounded-2xl shadow-2xl overflow-hidden animate-fadeInUp p-6">
            <div class="mb-4">
                <h3 class="text-xl font-semibold flex items-center gap-2">
                    <i class="ri-edit-line text-indigo-600 dark:text-indigo-400"></i>
                    重命名网站
                </h3>
                <p class="text-gray-600 dark:text-gray-400 text-sm mt-2">为您的网站选择一个新名称</p>
            </div>
            <form id="renameForm">
                <input type="hidden" id="renameSiteId">
                <div class="mb-4">
                    <label class="block text-gray-700 dark:text-gray-300 font-medium mb-2" for="newSiteName">新网站名称</label>
                    <input type="text" id="newSiteName" class="w-full px-4 py-3 rounded-lg border-2 border-gray-200 dark:border-gray-700 focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200 dark:focus:ring-indigo-900 bg-white dark:bg-gray-800 outline-none transition-colors" required>
                </div>
                <div class="flex justify-end gap-3 mt-6">
                    <button type="button" id="cancelRenameBtn" class="px-4 py-2 bg-gray-200 dark:bg-gray-700 rounded-lg text-gray-800 dark:text-gray-200 font-medium hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors">
                        取消
                    </button>
                    <button type="submit" class="px-4 py-2 bg-indigo-600 rounded-lg text-white font-medium hover:bg-indigo-700 transition-colors">
                        确认重命名
                    </button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- Delete confirmation modal -->
    <div id="deleteModal" class="fixed inset-0 bg-black/70 z-[9998] hidden overflow-y-auto">
        <div class="max-w-md mx-auto my-20 bg-white dark:bg-gray-800 rounded-2xl shadow-2xl overflow-hidden animate-fadeInUp p-6">
            <div class="mb-4">
                <h3 class="text-xl font-semibold flex items-center gap-2 text-red-600">
                    <i class="ri-error-warning-line"></i>
                    确认删除
                </h3>
                <p class="text-gray-600 dark:text-gray-400 text-sm mt-2">此操作不可撤销，网站将被永久删除</p>
            </div>
            <div class="bg-red-50 dark:bg-red-900/20 p-4 rounded-lg mb-6">
                <p class="text-center">确定要删除 <span id="deleteSiteName" class="font-semibold"></span> 吗？</p>
            </div>
            <form id="deleteForm">
                <input type="hidden" id="deleteSiteId">
                <div class="flex justify-end gap-3">
                    <button type="button" id="cancelDeleteBtn" class="px-4 py-2 bg-gray-200 dark:bg-gray-700 rounded-lg text-gray-800 dark:text-gray-200 font-medium hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors">
                        取消
                    </button>
                    <button type="submit" class="px-4 py-2 bg-red-600 rounded-lg text-white font-medium hover:bg-red-700 transition-colors">
                        确认删除
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Theme switcher
        const themeSwitcher = document.getElementById('themeSwitcher');
        const themeIcon = themeSwitcher.querySelector('i');
        
        // Check saved theme preference
        const savedTheme = localStorage.getItem('theme');
        if (savedTheme === 'dark' || (!savedTheme && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
            document.documentElement.classList.add('dark');
            themeIcon.className = 'ri-sun-line text-xl text-indigo-400';
        } else {
            document.documentElement.classList.remove('dark');
            themeIcon.className = 'ri-moon-line text-xl text-indigo-600';
        }
        
        themeSwitcher.addEventListener('click', () => {
            if (document.documentElement.classList.contains('dark')) {
                document.documentElement.classList.remove('dark');
                localStorage.setItem('theme', 'light');
                themeIcon.className = 'ri-moon-line text-xl text-indigo-600';
            } else {
                document.documentElement.classList.add('dark');
                localStorage.setItem('theme', 'dark');
                themeIcon.className = 'ri-sun-line text-xl text-indigo-400';
            }
        });

        // Loading helpers
        function showLoading() {
            document.getElementById('loading').classList.remove('hidden');
            document.getElementById('loading').classList.add('flex');
        }

        function hideLoading() {
            document.getElementById('loading').classList.add('hidden');
            document.getElementById('loading').classList.remove('flex');
        }

        // Toast notification
        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            const toastMessage = document.getElementById('toastMessage');
            const icon = toast.querySelector('i');
            
            if (type === 'success') {
                toast.className = 'fixed bottom-8 right-8 bg-green-600 text-white py-4 px-6 rounded-lg shadow-2xl flex items-center gap-3 z-[9999] transition-transform duration-300';
                icon.className = 'ri-check-line';
            } else {
                toast.className = 'fixed bottom-8 right-8 bg-red-600 text-white py-4 px-6 rounded-lg shadow-2xl flex items-center gap-3 z-[9999] transition-transform duration-300';
                icon.className = 'ri-error-warning-line';
            }
            
            toastMessage.textContent = message;
            toast.style.transform = 'translateX(0)';
            
            setTimeout(() => {
                toast.style.transform = 'translateX(400px)';
            }, 3000);
        }

        // File upload area
        const uploadArea = document.getElementById('uploadArea');
        const fileInput = document.getElementById('fileInput');

        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.classList.add('drag-over');
        });

        uploadArea.addEventListener('dragleave', () => {
            uploadArea.classList.remove('drag-over');
        });

        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.classList.remove('drag-over');
            
            const files = e.dataTransfer.files;
            if (files.length > 0 && files[0].name.endsWith('.zip')) {
                fileInput.files = files;
                const uploadAreaText = uploadArea.querySelector('p');
                if (uploadAreaText) {
                    uploadAreaText.textContent = `已选择: ${files[0].name}`;
                }
            } else {
                showToast('请上传ZIP格式的文件', 'error');
            }
        });

        fileInput.addEventListener('change', (e) => {
            if (e.target.files.length > 0) {
                const uploadAreaText = uploadArea.querySelector('p');
                if (uploadAreaText) {
                    uploadAreaText.textContent = `已选择: ${e.target.files[0].name}`;
                }
            }
        });

        // Form submissions
        document.getElementById('uploadForm').addEventListener('submit', function(e) {
            if (!fileInput.files || fileInput.files.length === 0) {
                e.preventDefault();
                showToast('请选择ZIP文件', 'error');
                return;
            }
            showLoading();
        });

        document.getElementById('pasteForm').addEventListener('submit', function(e) {
            const htmlCode = document.getElementById('htmlCode').value.trim();
            const siteName = document.getElementById('siteName').value.trim();
            
            if (!siteName) {
                e.preventDefault();
                showToast('请输入网站名称', 'error');
                return;
            }
            
            if (!htmlCode) {
                e.preventDefault();
                showToast('请输入HTML代码', 'error');
                return;
            }
            
            showLoading();
        });

        // Preview functionality
        const previewModal = document.getElementById('previewModal');
        const previewFrame = document.getElementById('previewFrame');
        const previewSiteName = document.getElementById('previewSiteName');
        const closePreviewBtn = document.getElementById('closePreviewBtn');
        
        document.querySelectorAll('.preview-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                const siteUrl = this.getAttribute('data-site-url');
                const siteName = this.getAttribute('data-site-name');
                
                previewSiteName.textContent = `预览: ${siteName}`;
                previewFrame.src = siteUrl;
                previewModal.classList.remove('hidden');
                document.body.style.overflow = 'hidden';
            });
        });
        
        closePreviewBtn.addEventListener('click', () => {
            previewModal.classList.add('hidden');
            document.body.style.overflow = '';
            setTimeout(() => { previewFrame.src = 'about:blank'; }, 300);
        });
        
        // Close modals when clicking outside
        previewModal.addEventListener('click', (e) => {
            if (e.target === previewModal) {
                closePreviewBtn.click();
            }
        });

        // ESC key to close modals
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                if (!previewModal.classList.contains('hidden')) {
                    closePreviewBtn.click();
                }
                if (!renameModal.classList.contains('hidden')) {
                    cancelRenameBtn.click();
                }
                if (!deleteModal.classList.contains('hidden')) {
                    cancelDeleteBtn.click();
                }
            }
        });

        // Rename modal functionality
        const renameModal = document.getElementById('renameModal');
        const renameForm = document.getElementById('renameForm');
        const newSiteName = document.getElementById('newSiteName');
        const renameSiteId = document.getElementById('renameSiteId');
        const cancelRenameBtn = document.getElementById('cancelRenameBtn');
        
        document.querySelectorAll('.rename-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                const siteItem = this.closest('.site-item');
                const siteId = siteItem.getAttribute('data-site-id');
                const siteName = siteItem.getAttribute('data-site-name');
                
                renameSiteId.value = siteId;
                newSiteName.value = siteName;
                
                renameModal.classList.remove('hidden');
                document.body.style.overflow = 'hidden';
                newSiteName.focus();
                newSiteName.select();
            });
        });
        
        cancelRenameBtn.addEventListener('click', () => {
            renameModal.classList.add('hidden');
            document.body.style.overflow = '';
        });
        
        renameModal.addEventListener('click', (e) => {
            if (e.target === renameModal) {
                cancelRenameBtn.click();
            }
        });
        
        renameForm.addEventListener('submit', (e) => {
            e.preventDefault();
            
            const siteId = renameSiteId.value;
            const newName = newSiteName.value.trim();
            
            if (!newName) {
                showToast('请输入新的网站名称', 'error');
                return;
            }
            
            showLoading();
            
            const formData = new FormData();
            formData.append('new_name', newName);
            
            fetch(`/rename_site/${encodeURIComponent(siteId)}`, { 
                method: 'POST', 
                body: formData 
            })
                .then(response => response.json())
                .then(data => {
                    hideLoading();
                    if (data.success) {
                        // Find the site item and update its name
                        const siteItems = document.querySelectorAll('.site-item');
                        for (const item of siteItems) {
                            if (item.getAttribute('data-site-id') === siteId) {
                                item.querySelector('.site-title').textContent = data.new_name;
                                item.setAttribute('data-site-name', data.new_name);
                                break;
                            }
                        }
                        
                        renameModal.classList.add('hidden');
                        document.body.style.overflow = '';
                        showToast('重命名成功');
                    } else {
                        showToast(data.msg || '重命名失败', 'error');
                    }
                })
                .catch(error => {
                    hideLoading();
                    showToast('重命名失败，请重试', 'error');
                });
        });

        // Delete modal functionality
        const deleteModal = document.getElementById('deleteModal');
        const deleteForm = document.getElementById('deleteForm');
        const deleteSiteId = document.getElementById('deleteSiteId');
        const deleteSiteName = document.getElementById('deleteSiteName');
        const cancelDeleteBtn = document.getElementById('cancelDeleteBtn');
        
        document.querySelectorAll('.delete-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                const siteItem = this.closest('.site-item');
                const siteId = siteItem.getAttribute('data-site-id');
                const siteName = siteItem.getAttribute('data-site-name');
                
                deleteSiteId.value = siteId;
                deleteSiteName.textContent = siteName;
                
                deleteModal.classList.remove('hidden');
                document.body.style.overflow = 'hidden';
            });
        });
        
        cancelDeleteBtn.addEventListener('click', () => {
            deleteModal.classList.add('hidden');
            document.body.style.overflow = '';
        });
        
        deleteModal.addEventListener('click', (e) => {
            if (e.target === deleteModal) {
                cancelDeleteBtn.click();
            }
        });
        
        deleteForm.addEventListener('submit', (e) => {
            e.preventDefault();
            
            const siteId = deleteSiteId.value;
            
            showLoading();
            
            fetch(`/delete_site/${encodeURIComponent(siteId)}`, { method: 'POST' })
                .then(response => response.json())
                .then(data => {
                    hideLoading();
                    if (data.success) {
                        // Find and remove the site item
                        const siteItems = document.querySelectorAll('.site-item');
                        for (const item of siteItems) {
                            if (item.getAttribute('data-site-id') === siteId) {
                                item.classList.add('animate-slideOutLeft');
                                setTimeout(() => {
                                    item.remove();
                                    updateSiteCount();
                                }, 500);
                                break;
                            }
                        }
                        
                        deleteModal.classList.add('hidden');
                        document.body.style.overflow = '';
                        showToast('网站删除成功');
                    } else {
                        showToast(data.msg || '删除失败', 'error');
                    }
                })
                .catch(error => {
                    hideLoading();
                    showToast('删除失败，请重试', 'error');
                });
        });

        // Update site count
        function updateSiteCount() {
            const count = document.querySelectorAll('.site-item').length;
            document.querySelector('.site-count').textContent = `${count} 个网站`;
            
            if (count === 0) {
                document.getElementById('sitesList').innerHTML = `
                    <div class="text-center py-12 text-gray-500 dark:text-gray-400">
                        <i class="ri-inbox-line text-6xl mb-4 opacity-30"></i>
                        <p class="text-lg">还没有发布任何网站</p>
                        <p class="text-sm mt-2">上传你的第一个网站吧！</p>
                    </div>
                `;
            }
        }
    </script>
</body>
</html>
